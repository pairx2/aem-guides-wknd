/*
	krpano HTML5 Sound Interface Plugin
*/

var krpanoplugin=function(){function e(e){return String("yesontrue1").indexOf(String(e).toLowerCase())>=0}function t(){v(!document.hidden)}function n(){var e,t,n=0;for(e in T)t=T[e],t&&n++}function r(){I="";var e=document.createElement("audio");if(null!==e&&void 0!==e)if(I+=".wav",void 0!==e.canPlayType){var t=e.canPlayType("audio/ogg");t.match(/maybe|probably/i)&&(I+=".ogg",I+=".oga"),(w.android&&w.firefox)===!1&&(t=e.canPlayType("audio/mpeg"),t.match(/maybe|probably/i)&&(I+=".mp3",I+=".mp2",I+=".mpa")),t=e.canPlayType("audio/mp4"),t.match(/maybe|probably/i)&&(I+=".mp4"),t=e.canPlayType("audio/wav"),t.match(/maybe|probably/i)&&(I+=".wav")}else I+=".mp3"}function i(e){var t=e.split("|");if(t.length>1){null===I&&r();var n,i=t.length;for(e=null,n=0;i>n;n++){var o=String(t[n]).toLowerCase(),a=o.slice(o.lastIndexOf("."));if(I.indexOf(a)>0){e=t[n];break}}null===e&&(e=t)}var u=L.rootpath;return null!==u&&u.length>0&&"null"!==String(u).toLowerCase()?"/"!==u.charAt(u.length-1)&&(u+="/"):u="",u+=e,u=decodeURI(b.parsePath(u))}function o(){}function a(){function e(){try{d.removeEventListener("touchstart",e,!0),S&&S.paused&&!S.ended&&S.play()}catch(t){S=null}}var t=arguments;if(t.length>1){var r=String(t[0]).toLowerCase(),o=t[1],a=t.length>2?parseInt(t[2]):1,c=t.length>3?t[3]:null;("auto"===r||null===r||""===r)&&(r="autoid_"+b.timertick+"_"+Math.ceil(1e3*b.random)),o=i(o);var l=null;if(_&&E&&void 0!==T[r]){l=T[r];try{l.currentTime=0,l.pause()}catch(s){}T[r]=null,delete T[r],l=null}if(null!==l||void 0!==T[r]){null===l?l=T[r]:T[r]=l;try{l.currentTime=0,l.pause()}catch(s){}}else{if(l=document.createElement("audio"),!l)return void b.trace(2,C);l.addEventListener("error",function(e){b.trace(3,"soundinterface - loading of "+o+" failed!"),T[r]=null,delete T[r],l=null},!0),l.addEventListener("ended",function(e){try{l.loopcount>0?(l.loopcount--,0===l.loopcount?c&&b.call(c):(l.currentTime=0,l.play())):(l.currentTime=0,l.play())}catch(t){}},!0),T[r]=l}try{if(l.loopcount=a,l.src=o,l&&(l.volume=k,l._volume=k,l.play(),u(r)),_&&l&&l.paused){var d=document.body;d.removeEventListener("touchstart",e,!0),S=l,d.addEventListener("touchstart",e,!0)}}catch(s){b.trace(2,C)}}n()}function u(e){var t=T.createItem(e),n=this;t.registerattribute("volume",1,function(e){n.volume=e},function(){return n.volume}),t.registerattribute("test","This is a test",function(e){c(e)},function(){return"Get Test Worked"}),t.registerattribute("name",e,function(e){n.name=e},function(){return n.name})}function c(e){}function l(e){var t=T[String(e).toLowerCase()];if(t)try{t.pause()}catch(n){}}function s(e){var t=T[String(e).toLowerCase()];if(t)try{t.paused&&t.play()}catch(n){}}function d(e){var t=T[String(e).toLowerCase()];if(t)try{t.paused?t.play():t.pause()}catch(n){}}function f(e){var t=T[String(e).toLowerCase()];if(t){t===S&&(S=null);try{t.currentTime=0,t.pause()}catch(n){}}}function p(){var e,t;for(e in T)if(t=T[e],t&&void 0!==t.paused){try{t.pause()}catch(n){}T[e]=null,t=null}T=[],S=null}function v(e){var t,n;for(t in T){n=T[t];try{n&&void 0!==n.paused&&(e===!1?n.paused===!1&&(n.pause(),n.needresume=!0):n.needresume&&n.play())}catch(r){}}}function m(){k=x?0:P;var e,t;for(e in T)if(t=T[e])try{t.volume=k,_&&(x?t.paused===!1&&(t._krp_muted=!0,t.pause()):t._krp_muted===!0&&(t._krp_muted=!1,t.play()))}catch(n){}}function y(e,t){var n=T[String(e).toLowerCase()];if(n){if(t.substring){var r=t.indexOf("%");r>=0&&(t=t.substr(0,r),t=t/100*n.duration)}try{n.currentTime=t}catch(i){}}}function g(e,t,n,r){void 0===t&&(t="currenttime"),void 0===n&&(n="duration"),void 0===r&&(r="playpct");var i=T[String(e).toLowerCase()];if(i)try{b.set(t,i.currentTime),b.set(n,i.duration),b.set(r,i.currentTime/i.duration)}catch(o){}}var h=this,b=null,L=null,w=null,T=[],S=null,_=!1,E=!1,C="Soundinterface Plugin - HTML5 audio is not supported by this browser!",k=1,P=1,x=!1;h.registerplugin=function(r,i,u){return b=r,L=u,w=b.device,b.version<"1.17"?void b.trace(3,"Soundinterface Plugin - too old krpano version, min. version is 1.17!"):(n(),b.set("sound[_initdummy_].init",!0),T=b.get("sound"),T.removeItem("_initdummy_"),n(),u.keep=!0,u.registerattribute("rootpath",""),u.registerattribute("volume",1,function(e){P=e,m()},function(){return P}),u.registerattribute("mute",!1,function(t){x=e(t),m()},function(){return x}),b.soundinterface=u,b.preloadsound=o,b.playsound=a,b.pausesound=l,b.resumesound=s,b.pausesoundtoggle=d,b.stopsound=f,b.stopallsounds=p,b.setsoundtime=y,b.getsoundtime=g,E=w.ios&&w.iosversion<4.2,_=w.ios||w.android,window.addEventListener("pagehide",function(){v(!1)},!1),window.addEventListener("pageshow",function(){v(!0)},!1),void document.addEventListener("visibilitychange",t))},h.unloadplugin=function(){try{p(),document.removeEventListener("visibilitychange",t)}catch(e){}};var I=null};